{% extends 'base.html.twig' %}

{% block title %}Notifications{% endblock %}

{% block body %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 min-h-[600px]">
         <!-- Header & Filters -->
        <div class="border-b border-gray-200">
            <div class="p-4">
                <h1 class="text-xl font-bold text-gray-900">Notifications</h1>
            </div>
            <div class="flex px-4 gap-6">
                <button class="filter-btn active pb-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600 hover:text-blue-700 transition-colors" data-filter="all">
                    All
                </button>
                 <button class="filter-btn pb-3 text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors" data-filter="mention">
                    Mentions
                </button>
                 <button class="filter-btn pb-3 text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors" data-filter="follow">
                    Follows
                </button>
                 <button class="filter-btn pb-3 text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors" data-filter="like">
                    Likes
                </button>
            </div>
        </div>

        <!-- Notifications List -->
        <div class="flex flex-col" id="notifications-list">
            {% for notification in notifications %}
                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150 cursor-pointer flex items-start gap-4 {{ notification.isRead ? 'opacity-60' : 'bg-blue-50/30' }}" data-type="{{ notification.type }}">
                   <!-- Icon Type -->
                   <div class="relative flex-shrink-0">
                        <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-sm overflow-hidden">
                            {% if notification.actor.avatar %}
                                <img src="{{ asset('uploads/avatars/' ~ notification.actor.avatar) }}" class="w-full h-full object-cover">
                            {% else %}
                                {{ notification.actor.pseudo|first|upper }}
                            {% endif %}
                        </div>
                         <div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-2 border-white flex items-center justify-center
                            {% if notification.type == 'like' %} bg-pink-500 text-white
                            {% elseif notification.type == 'follow' %} bg-blue-500 text-white
                            {% elseif notification.type == 'mention' or notification.type == 'comment' or notification.type == 'repost' %} bg-green-500 text-white
                            {% endif %}">
                            {% if notification.type == 'like' %}
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z" /></svg>
                            {% elseif notification.type == 'follow' %}
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3"><path d="M5.25 9a6.75 6.75 0 0 1 13.5 0v.75c0 2.123.8 4.057 2.118 5.52a.75.75 0 0 1-.297 1.206c-1.544.57-3.16.99-4.831 1.243a3.75 3.75 0 1 1-7.48 0 24.585 24.585 0 0 1-4.831-1.244.75.75 0 0 1-.298-1.205A8.217 8.217 0 0 0 5.25 9.75V9Zm4.502 8.9a2.25 2.25 0 1 0 4.496 0 25.057 25.057 0 0 1-4.496 0Z" /></svg>
                            {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3"><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z" clip-rule="evenodd" /></svg>
                            {% endif %}
                         </div>
                   </div>

                   <!-- Content -->
                   <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                             <div class="text-sm">
                                <span class="font-bold text-gray-900">{{ notification.actor.fullName }}</span>
                                <span class="text-gray-500">{{ notification.message }}</span>
                            </div>
                            <span class="text-xs text-gray-400 whitespace-nowrap ml-2">{{ notification.createdAt|date('d M H:i') }}</span>
                        </div>
                   </div>
                   
                   {% if not notification.isRead %}
                    <span class="inline-block w-2 h-2 bg-blue-600 rounded-full mt-1.5"></span>
                   {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const buttons = document.querySelectorAll('.filter-btn');
        const items = document.querySelectorAll('.notification-item');

        const activeClasses = ['text-blue-600', 'border-b-2', 'border-blue-600', 'active'];
        const inactiveClasses = ['text-gray-500', 'hover:text-gray-700'];

        function setButtonState(btn, isActive) {
            if (isActive) {
                btn.classList.remove(...inactiveClasses);
                btn.classList.add(...activeClasses);
            } else {
                btn.classList.remove(...activeClasses);
                btn.classList.add(...inactiveClasses);
            }
        }

        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                // Reset all buttons
                buttons.forEach(b => setButtonState(b, false));
                // Activate clicked button
                setButtonState(btn, true);

                const filter = btn.dataset.filter;

                // Filter items
                items.forEach(item => {
                    if (filter === 'all' || item.dataset.type === filter) {
                        item.classList.remove('hidden');
                        // Animation reset
                        item.style.animation = 'none';
                        item.offsetHeight; /* trigger reflow */
                        item.style.animation = 'fadeIn 0.3s ease-out';
                    } else {
                        item.classList.add('hidden');
                    }
                });
            });
        });
    });
</script>

<style>
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}
