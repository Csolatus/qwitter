{% extends 'base.html.twig' %}

{% block title %}Accueil / Qwitter{% endblock %}

{% block body %}
<div class="flex min-h-screen bg-white justify-center"> <!-- Centrage global -->
    
    <div class="flex w-full max-w-[1300px]"> <!-- Largeur max standard Twitter -->




        <!-- COLONNE 2 : FIL D'ACTUALIT√â -->
        <main class="flex-1 max-w-[600px] w-full border-r border-gray-100 min-h-screen">
            
            <!-- Header Sticky -->
            <div class="bg-white/90 backdrop-blur-md px-4 py-3 border-b border-gray-100 cursor-pointer">
                <h1 class="text-xl font-bold text-slate-800">Accueil</h1>
            </div>

            <!-- Cr√©ation de Post -->
            <div class="p-4 border-b border-gray-100 pb-2">
                {{ form_start(form, {'attr': {'class': 'flex gap-4'}}) }}
                    <div class="w-10 h-10 rounded-full bg-slate-200 flex-shrink-0 overflow-hidden">
                        <!-- Avatar Utilisateur Connect√© -->
                        {% if app.user and app.user.avatar %}
                            <img src="{{ asset('uploads/avatars/' ~ app.user.avatar) }}" class="w-full h-full object-cover">
                        {% elseif app.user %}
                             <img src="https://ui-avatars.com/api/?name={{ app.user.pseudo }}&background=0f172a&color=fff" class="w-full h-full object-cover">
                        {% else %}
                             <div class="w-full h-full bg-slate-800"></div>
                        {% endif %}
                    </div>
                    <div class="flex-1">
                        {{ form_widget(form.content) }}
                        <div class="text-red-500 text-sm py-1">{{ form_errors(form.content) }}</div>
                        
                        <div class="flex justify-between items-center mt-2 border-t border-gray-50 pt-2">
                            <div class="flex gap-1 text-slate-400 items-center">
                                <label for="{{ form.image.vars.id }}" class="hover:bg-blue-50 hover:text-blue-500 p-2 rounded-full transition cursor-pointer" title="Image">
                                    üì∑
                                </label>
                                {{ form_widget(form.image) }}
                                <div class="text-red-500 text-sm">{{ form_errors(form.image) }}</div>

                                <button type="button" class="hover:bg-blue-50 hover:text-blue-500 p-2 rounded-full transition" title="GIF">GIF</button>
                                <button type="button" class="hover:bg-blue-50 hover:text-blue-500 p-2 rounded-full transition" title="Sondage">üìä</button>
                                <button type="button" class="hover:bg-blue-50 hover:text-blue-500 p-2 rounded-full transition" title="Emoji">üòä</button>
                            </div>
                            <button type="submit" class="bg-slate-800 text-white px-5 py-1.5 rounded-full font-bold text-sm hover:bg-slate-900 transition">Poster</button>
                        </div>
                    </div>
                {{ form_end(form) }}
            </div>

            <!-- Fil des Posts -->
            <div class="posts-feed">
                {% for post in posts %}
                    {% include 'partials/_post.html.twig' with {'post': post} %}
                {% else %}
                    <!-- √âtat vide -->
                    <div class="py-12 px-8 text-center">
                        <div class="text-4xl mb-4">üëã</div>
                        <h3 class="text-xl font-bold text-slate-800 mb-2">Bienvenue sur Qwitter !</h3>
                        <p class="text-gray-500 mb-6">Votre fil d'actualit√© est vide. Personne n'a encore post√© ?</p>
                        <button class="bg-slate-800 text-white px-6 py-2 rounded-full font-bold hover:bg-slate-900 transition">Poster le premier message</button>
                    </div>
                {% endfor %}
            </div>
        </main>


        <!-- COLONNE 3 : WIDGETS (Suggestions, Recherche) -->
        <aside class="hidden lg:block w-[350px] pl-8 py-4 h-screen sticky top-0 overflow-y-auto">
            
            <!-- Recherche -->
            <div class="sticky top-0 bg-white pb-4 z-10 pt-1">
                <div class="relative group">
                    <span class="absolute left-4 top-3.5 text-gray-500 group-focus-within:text-blue-500">üîç</span>
                    <input type="text" placeholder="Rechercher" class="w-full bg-gray-100 rounded-full py-3 pl-12 pr-4 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 focus:outline-none transition border-none">
                </div>
            </div>

            <!-- Bloc Tendances -->
            <div class="bg-gray-50 rounded-2xl mb-4 overflow-hidden border border-gray-100">
                <h2 class="font-bold text-lg p-4 pb-2 text-slate-900">Tendances pour vous</h2>
                
                <div class="hover:bg-gray-100 px-4 py-3 cursor-pointer transition">
                    <div class="text-xs text-gray-500 flex justify-between">
                        <span>D√©veloppement ¬∑ Tendance</span>
                        <button class="hover:bg-blue-50 rounded-full p-1">‚Ä¢‚Ä¢‚Ä¢</button>
                    </div>
                    <div class="font-bold text-slate-800">#Symfony</div>
                    <div class="text-xs text-gray-500">2,458 posts</div>
                </div>

                <div class="hover:bg-gray-100 px-4 py-3 cursor-pointer transition">
                    <div class="text-xs text-gray-500 flex justify-between">
                        <span>√âcole ¬∑ Tendance</span>
                        <button class="hover:bg-blue-50 rounded-full p-1">‚Ä¢‚Ä¢‚Ä¢</button>
                    </div>
                    <div class="font-bold text-slate-800">Projet Web</div>
                    <div class="text-xs text-gray-500">1,241 posts</div>
                </div>
                
                <a href="#" class="block p-4 text-blue-500 text-sm hover:bg-gray-100 transition rounded-b-2xl">Voir plus</a>
            </div>

            <!-- Bloc Suggestions (Dynamique) -->
            <div class="bg-gray-50 rounded-2xl overflow-hidden border border-gray-100">
                <h2 class="font-bold text-lg p-4 pb-2 text-slate-900">Suggestions</h2>
                
                {% for user in suggestions|default([]) %}
                    <div class="px-4 py-3 hover:bg-gray-100 flex items-center justify-between cursor-pointer transition">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-gray-300 overflow-hidden">
                                {% if user.avatar %}
                                    <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}" class="w-full h-full object-cover">
                                {% else %}
                                    <img src="https://ui-avatars.com/api/?name={{ user.pseudo }}&background=random" class="w-full h-full object-cover">
                                {% endif %}
                            </div>
                            <div class="leading-tight">
                                <div class="font-bold text-slate-900 text-sm hover:underline">{{ user.fullName }}</div>
                                <div class="text-gray-500 text-xs">@{{ user.pseudo }}</div>
                            </div>
                        </div>
                        <button class="bg-slate-900 text-white text-xs font-bold px-4 py-1.5 rounded-full hover:bg-slate-700 transition">Suivre</button>
                    </div>
                {% else %}
                    <div class="px-4 py-3 text-sm text-gray-500">Pas encore de suggestions.</div>
                {% endfor %}

                <a href="#" class="block p-4 text-blue-500 text-sm hover:bg-gray-100 transition rounded-b-2xl">Voir plus</a>
            </div>

            <nav class="flex flex-wrap gap-x-3 gap-y-1 mt-4 px-2 text-xs text-gray-400">
                <a href="#" class="hover:underline">Conditions</a>
                <a href="#" class="hover:underline">Confidentialit√©</a>
                <a href="#" class="hover:underline">Cookies</a>
                <span>¬© 2026 Qwitter</span>
            </nav>

        </aside>

    </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
    function toggleCommentForm(postId) {
        const form = document.getElementById('comment-form-' + postId);
        form.classList.toggle('hidden');
    }
</script>
{% endblock %}
