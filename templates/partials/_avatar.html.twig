{# templates/partials/_avatar.html.twig #}
{# 
    Arguments:
    - user: User entity (required)
    - size: CSS classes for width/height (default: 'w-10 h-10')
    - class: Additional CSS classes (optional)
#}

{% set size = size|default('w-10 h-10') %}
{% set extra_classes = class|default('') %}

{% set colors = [
    'bg-red-500', 'bg-orange-500', 'bg-amber-500', 'bg-yellow-500', 
    'bg-lime-500', 'bg-green-500', 'bg-emerald-500', 'bg-teal-500', 
    'bg-cyan-500', 'bg-sky-500', 'bg-blue-500', 'bg-indigo-500', 
    'bg-violet-500', 'bg-purple-500', 'bg-fuchsia-500', 'bg-pink-500', 'bg-rose-500'
] %}
{% set colorIndex = (user ? user.id : 0) % colors|length %}
{% set bgColor = colors[colorIndex] %}

<div class="{{ size }} rounded-full {{ user and user.avatar ? 'bg-slate-200' : bgColor }} flex-shrink-0 overflow-hidden flex items-center justify-center text-white font-bold {{ extra_classes }}">
    {% if user and user.avatar %}
        <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}" alt="{{ user.pseudo }}" class="w-full h-full object-cover">
    {% elseif user %}
        {# Initials Avatar with Random Color #}
        <span class="text-sm">{{ user.pseudo|first|upper }}</span>
    {% else %}
        {# Fallback: Anonymous/Deleted User #}
        <div class="w-full h-full bg-slate-400 flex items-center justify-center text-white">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-1/2 h-1/2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
            </svg>
        </div>
    {% endif %}
</div>
